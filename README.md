# Сборка ядра Linux

### Подготовка

- Убедимся, что все необходимые программы установлены в системе ([ссылка](https://www.kernel.org/doc/html/latest/process/changes.html#));

    > [!IMPORTANT]  
    > Очень важно установить `grub`, чтобы при запуске системы можно было выбрать, какое из ядер запускать.
- Склонируем официальный репозиторий версии 6.11 ([ссылка](https://github.com/torvalds/linux/tree/98f7e32f20d28ec452afb208f9cffc08448a2652));
- Выведем текущую версию ядра и архитектуру:

    ![uname](/img/6.5.0.jpg)

### Сборка и установка ядра

- `make defconfig` - создадим дефолтную конфигурацию ядра;
- `make menuconfig` - в открывшемся окне изменим необходимые параметры ядра. Для этого проверим, что в сборку включены драйверы для подключения к сети, bluetooth, вывода аудио и т.д. Также исключим из сборки большое количество ненужных драйверов;
- Итоговый конфигурационный файл можно посмотреть, перейдя в [/config](https://github.com/EltexEmbeddedC/kernel-building/blob/main/config/.config);
- `sudo make -j<число ядер> bzImage` - соберем ядро;

    ![сборка ядра](/img/bzImage.jpg)
- `sudo make -j<число ядер> modules` - соберем модули ядра;

    ![сборка модулей](/img/modules.jpg)
- Теперь установим всё это в систему:
    ```bash
    sudo make modules_install
    sudo make install
    ```

    ![ecnfyjdrf](/img/install.jpg)

### Тестирование

- Перезапустим систему;
- В открывшемся окне `grub` выберем новую версию ядра;
- После входа в систему выведем текущую версию ядра и архитектуру:

    ![uname](/img/6.11.0.jpg)
- Проверим работу основных систем: интернета, bluetooth, воспроизведение аудио;
- После успешного прохождения этих этапов ядро можно считать успешно установленным.
